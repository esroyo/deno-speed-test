/* esm.sh - @cloudflare/speedtest@1.6.0 */
var Wn=Object.create;var Nt=Object.defineProperty;var Bn=Object.getOwnPropertyDescriptor;var Fn=Object.getOwnPropertyNames;var qn=Object.getPrototypeOf,$n=Object.prototype.hasOwnProperty;var ct=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var zn=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Fn(t))!$n.call(e,i)&&i!==n&&Nt(e,i,{get:()=>t[i],enumerable:!(r=Bn(t,i))||r.enumerable});return e};var Ht=(e,t,n)=>(n=e!=null?Wn(qn(e)):{},zn(t||!e||!e.__esModule?Nt(n,"default",{value:e,enumerable:!0}):n,e));var Gt=ct((Ee,Jt)=>{(function(e,t){typeof Ee=="object"&&typeof Jt!="undefined"?t(Ee):typeof define=="function"&&define.amd?define(["exports"],t):t(e.WHATWGFetch={})})(Ee,function(e){"use strict";var t=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof globalThis!="undefined"&&globalThis||{},n={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(o){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function r(o){return o&&DataView.prototype.isPrototypeOf(o)}if(n.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(o){return o&&i.indexOf(Object.prototype.toString.call(o))>-1};function c(o){if(typeof o!="string"&&(o=String(o)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(o)||o==="")throw new TypeError('Invalid character in header field name: "'+o+'"');return o.toLowerCase()}function u(o){return typeof o!="string"&&(o=String(o)),o}function l(o){var f={next:function(){var b=o.shift();return{done:b===void 0,value:b}}};return n.iterable&&(f[Symbol.iterator]=function(){return f}),f}function h(o){this.map={},o instanceof h?o.forEach(function(f,b){this.append(b,f)},this):Array.isArray(o)?o.forEach(function(f){if(f.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+f.length);this.append(f[0],f[1])},this):o&&Object.getOwnPropertyNames(o).forEach(function(f){this.append(f,o[f])},this)}h.prototype.append=function(o,f){o=c(o),f=u(f);var b=this.map[o];this.map[o]=b?b+", "+f:f},h.prototype.delete=function(o){delete this.map[c(o)]},h.prototype.get=function(o){return o=c(o),this.has(o)?this.map[o]:null},h.prototype.has=function(o){return this.map.hasOwnProperty(c(o))},h.prototype.set=function(o,f){this.map[c(o)]=u(f)},h.prototype.forEach=function(o,f){for(var b in this.map)this.map.hasOwnProperty(b)&&o.call(f,this.map[b],b,this)},h.prototype.keys=function(){var o=[];return this.forEach(function(f,b){o.push(b)}),l(o)},h.prototype.values=function(){var o=[];return this.forEach(function(f){o.push(f)}),l(o)},h.prototype.entries=function(){var o=[];return this.forEach(function(f,b){o.push([b,f])}),l(o)},n.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);function d(o){if(!o._noBody){if(o.bodyUsed)return Promise.reject(new TypeError("Already read"));o.bodyUsed=!0}}function v(o){return new Promise(function(f,b){o.onload=function(){f(o.result)},o.onerror=function(){b(o.error)}})}function T(o){var f=new FileReader,b=v(f);return f.readAsArrayBuffer(o),b}function w(o){var f=new FileReader,b=v(f),_=/charset=([A-Za-z0-9_-]+)/.exec(o.type),C=_?_[1]:"utf-8";return f.readAsText(o,C),b}function R(o){for(var f=new Uint8Array(o),b=new Array(f.length),_=0;_<f.length;_++)b[_]=String.fromCharCode(f[_]);return b.join("")}function I(o){if(o.slice)return o.slice(0);var f=new Uint8Array(o.byteLength);return f.set(new Uint8Array(o)),f.buffer}function O(){return this.bodyUsed=!1,this._initBody=function(o){this.bodyUsed=this.bodyUsed,this._bodyInit=o,o?typeof o=="string"?this._bodyText=o:n.blob&&Blob.prototype.isPrototypeOf(o)?this._bodyBlob=o:n.formData&&FormData.prototype.isPrototypeOf(o)?this._bodyFormData=o:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)?this._bodyText=o.toString():n.arrayBuffer&&n.blob&&r(o)?(this._bodyArrayBuffer=I(o.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(o)||s(o))?this._bodyArrayBuffer=I(o):this._bodyText=o=Object.prototype.toString.call(o):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof o=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var o=d(this);if(o)return o;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var o=d(this);return o||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(n.blob)return this.blob().then(T);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var o=d(this);if(o)return o;if(this._bodyBlob)return w(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function W(o){var f=o.toUpperCase();return A.indexOf(f)>-1?f:o}function P(o,f){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');f=f||{};var b=f.body;if(o instanceof P){if(o.bodyUsed)throw new TypeError("Already read");this.url=o.url,this.credentials=o.credentials,f.headers||(this.headers=new h(o.headers)),this.method=o.method,this.mode=o.mode,this.signal=o.signal,!b&&o._bodyInit!=null&&(b=o._bodyInit,o.bodyUsed=!0)}else this.url=String(o);if(this.credentials=f.credentials||this.credentials||"same-origin",(f.headers||!this.headers)&&(this.headers=new h(f.headers)),this.method=W(f.method||this.method||"GET"),this.mode=f.mode||this.mode||null,this.signal=f.signal||this.signal||function(){if("AbortController"in t){var S=new AbortController;return S.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&b)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(b),(this.method==="GET"||this.method==="HEAD")&&(f.cache==="no-store"||f.cache==="no-cache")){var _=/([?&])_=[^&]*/;if(_.test(this.url))this.url=this.url.replace(_,"$1_="+new Date().getTime());else{var C=/\?/;this.url+=(C.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function k(o){var f=new FormData;return o.trim().split("&").forEach(function(b){if(b){var _=b.split("="),C=_.shift().replace(/\+/g," "),S=_.join("=").replace(/\+/g," ");f.append(decodeURIComponent(C),decodeURIComponent(S))}}),f}function M(o){var f=new h,b=o.replace(/\r?\n[\t ]+/g," ");return b.split("\r").map(function(_){return _.indexOf(`
`)===0?_.substr(1,_.length):_}).forEach(function(_){var C=_.split(":"),S=C.shift().trim();if(S){var V=C.join(":").trim();try{f.append(S,V)}catch(re){console.warn("Response "+re.message)}}}),f}O.call(P.prototype);function x(o,f){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(f||(f={}),this.type="default",this.status=f.status===void 0?200:f.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=f.statusText===void 0?"":""+f.statusText,this.headers=new h(f.headers),this.url=f.url||"",this._initBody(o)}O.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},x.error=function(){var o=new x(null,{status:200,statusText:""});return o.ok=!1,o.status=0,o.type="error",o};var z=[301,302,303,307,308];x.redirect=function(o,f){if(z.indexOf(f)===-1)throw new RangeError("Invalid status code");return new x(null,{status:f,headers:{location:o}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(o){e.DOMException=function(f,b){this.message=f,this.name=b;var _=Error(f);this.stack=_.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function K(o,f){return new Promise(function(b,_){var C=new P(o,f);if(C.signal&&C.signal.aborted)return _(new e.DOMException("Aborted","AbortError"));var S=new XMLHttpRequest;function V(){S.abort()}S.onload=function(){var U={statusText:S.statusText,headers:M(S.getAllResponseHeaders()||"")};C.url.indexOf("file://")===0&&(S.status<200||S.status>599)?U.status=200:U.status=S.status,U.url="responseURL"in S?S.responseURL:U.headers.get("X-Request-URL");var N="response"in S?S.response:S.responseText;setTimeout(function(){b(new x(N,U))},0)},S.onerror=function(){setTimeout(function(){_(new TypeError("Network request failed"))},0)},S.ontimeout=function(){setTimeout(function(){_(new TypeError("Network request timed out"))},0)},S.onabort=function(){setTimeout(function(){_(new e.DOMException("Aborted","AbortError"))},0)};function re(U){try{return U===""&&t.location.href?t.location.href:U}catch(N){return U}}if(S.open(C.method,re(C.url),!0),C.credentials==="include"?S.withCredentials=!0:C.credentials==="omit"&&(S.withCredentials=!1),"responseType"in S&&(n.blob?S.responseType="blob":n.arrayBuffer&&(S.responseType="arraybuffer")),f&&typeof f.headers=="object"&&!(f.headers instanceof h||t.Headers&&f.headers instanceof t.Headers)){var be=[];Object.getOwnPropertyNames(f.headers).forEach(function(U){be.push(c(U)),S.setRequestHeader(U,u(f.headers[U]))}),C.headers.forEach(function(U,N){be.indexOf(N)===-1&&S.setRequestHeader(N,U)})}else C.headers.forEach(function(U,N){S.setRequestHeader(N,U)});C.signal&&(C.signal.addEventListener("abort",V),S.onreadystatechange=function(){S.readyState===4&&C.signal.removeEventListener("abort",V)}),S.send(typeof C._bodyInit=="undefined"?null:C._bodyInit)})}K.polyfill=!0,t.fetch||(t.fetch=K,t.Headers=h,t.Request=P,t.Response=x),e.Headers=h,e.Request=P,e.Response=x,e.fetch=K,Object.defineProperty(e,"__esModule",{value:!0})})});var Xt=ct((Ca,Vt)=>{Gt();Vt.exports=self.fetch.bind(self)});var an=ct((Ra,rn)=>{var Nn="Expected a function",Zt="__lodash_hash_undefined__",Hn="[object Function]",Jn="[object GeneratorFunction]",Gn=/[\\^$.*+?()[\]{}|]/g,Vn=/^\[object .+?Constructor\]$/,Xn=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,Qn=typeof self=="object"&&self&&self.Object===Object&&self,Kt=Xn||Qn||Function("return this")();function Zn(e,t){return e==null?void 0:e[t]}function Kn(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch(n){}return t}var Yn=Array.prototype,er=Function.prototype,Yt=Object.prototype,lt=Kt["__core-js_shared__"],Qt=function(){var e=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),en=er.toString,ft=Yt.hasOwnProperty,tr=Yt.toString,nr=RegExp("^"+en.call(ft).replace(Gn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rr=Yn.splice,ar=tn(Kt,"Map"),we=tn(Object,"create");function ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ir(){this.__data__=we?we(null):{}}function sr(e){return this.has(e)&&delete this.__data__[e]}function or(e){var t=this.__data__;if(we){var n=t[e];return n===Zt?void 0:n}return ft.call(t,e)?t[e]:void 0}function ur(e){var t=this.__data__;return we?t[e]!==void 0:ft.call(t,e)}function cr(e,t){var n=this.__data__;return n[e]=we&&t===void 0?Zt:t,this}ae.prototype.clear=ir;ae.prototype.delete=sr;ae.prototype.get=or;ae.prototype.has=ur;ae.prototype.set=cr;function ce(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function lr(){this.__data__=[]}function fr(e){var t=this.__data__,n=Ue(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():rr.call(t,n,1),!0}function dr(e){var t=this.__data__,n=Ue(t,e);return n<0?void 0:t[n][1]}function hr(e){return Ue(this.__data__,e)>-1}function pr(e,t){var n=this.__data__,r=Ue(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}ce.prototype.clear=lr;ce.prototype.delete=fr;ce.prototype.get=dr;ce.prototype.has=hr;ce.prototype.set=pr;function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function mr(){this.__data__={hash:new ae,map:new(ar||ce),string:new ae}}function gr(e){return De(this,e).delete(e)}function vr(e){return De(this,e).get(e)}function yr(e){return De(this,e).has(e)}function br(e,t){return De(this,e).set(e,t),this}ie.prototype.clear=mr;ie.prototype.delete=gr;ie.prototype.get=vr;ie.prototype.has=yr;ie.prototype.set=br;function Ue(e,t){for(var n=e.length;n--;)if(Mr(e[n][0],t))return n;return-1}function wr(e){if(!nn(e)||Sr(e))return!1;var t=Pr(e)||Kn(e)?nr:Vn;return t.test(kr(e))}function De(e,t){var n=e.__data__;return _r(t)?n[typeof t=="string"?"string":"hash"]:n.map}function tn(e,t){var n=Zn(e,t);return wr(n)?n:void 0}function _r(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Sr(e){return!!Qt&&Qt in e}function kr(e){if(e!=null){try{return en.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function dt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(Nn);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var c=e.apply(this,r);return n.cache=s.set(i,c),c};return n.cache=new(dt.Cache||ie),n}dt.Cache=ie;function Mr(e,t){return e===t||e!==e&&t!==t}function Pr(e){var t=nn(e)?tr.call(e):"";return t==Hn||t==Jn}function nn(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}rn.exports=dt});var Qa=Ht(Xt()),Pn=Ht(an());function se(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ht(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function je(e){let t,n,r;e.length!==2?(t=se,n=(u,l)=>se(e(u),l),r=(u,l)=>e(u)-l):(t=e===se||e===ht?e:Or,n=e,r=e);function i(u,l,h=0,d=u.length){if(h<d){if(t(l,l)!==0)return d;do{let v=h+d>>>1;n(u[v],l)<0?h=v+1:d=v}while(h<d)}return h}function s(u,l,h=0,d=u.length){if(h<d){if(t(l,l)!==0)return d;do{let v=h+d>>>1;n(u[v],l)<=0?h=v+1:d=v}while(h<d)}return h}function c(u,l,h=0,d=u.length){let v=i(u,l,h,d-1);return v>h&&r(u[v-1],l)>-r(u[v],l)?v-1:v}return{left:i,center:c,right:s}}function Or(){return 0}function pt(e){return e===null?NaN:+e}var sn=je(se),on=sn.right,Lr=sn.left,Tr=je(pt).center,mt=on;function un(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function X(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[mt(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var c=t.indexOf(s);return[e[c-1],e[c]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return X().domain(e).range(t).unknown(n)},un.apply(i,arguments)}function Pt(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function xr(e){if(Array.isArray(e))return e}function Cr(e){if(Array.isArray(e))return Pt(e)}function g(e,t,n){if(typeof e=="function"?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function Rr(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function st(e,t,n){return t=ue(t),Wr(e,Ln()?Reflect.construct(t,n||[],ue(e).constructor):t.apply(e,n))}function On(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return e.get(g(e,t))}function p(e,t,n){On(e,t),t.set(e,n)}function m(e,t,n){return e.set(g(e,t),n),n}function Ae(e,t){On(e,t),t.add(e)}function Ar(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xn(r.key),r)}}function $(e,t,n){return t&&Ar(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t,n){return(t=xn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ot(){return Ot=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Tn(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ot.apply(null,arguments)}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ue(e)}function ot(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}function Ln(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ln=function(){return!!e})()}function Er(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ur(e,t){var n=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,i,s,c,u=[],l=!0,h=!1;try{if(s=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(u.push(r.value),u.length!==t);l=!0);}catch(d){h=!0,i=d}finally{try{if(!l&&n.return!=null&&(c=n.return(),Object(c)!==c))return}finally{if(h)throw i}}return u}}function Dr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cn(Object(n),!0).forEach(function(r){y(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ee(e,t){if(e==null)return{};var n,r,i=Ir(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Ir(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;n[r]=e[r]}return n}function Wr(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rr(e)}function Lt(e,t,n,r){return Lt=typeof Reflect!="undefined"&&Reflect.set?Reflect.set:function(i,s,c,u){var l,h=Tn(i,s);if(h){if((l=Object.getOwnPropertyDescriptor(h,s)).set)return l.set.call(u,c),!0;if(!l.writable)return!1}if(l=Object.getOwnPropertyDescriptor(u,s)){if(!l.writable)return!1;l.value=c,Object.defineProperty(u,s,l)}else y(u,s,c);return!0},Lt(e,t,n,r)}function Br(e,t,n,r,i){if(!Lt(e,t,n,r||e)&&i)throw new TypeError("failed to set property");return n}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Tt(e,t)}function F(e,t){return xr(e)||Ur(e,t)||Cn(e,t)||Dr()}function Tn(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=ue(e))!==null;);return e}function Fr(e,t,n,r){var i=Ot(ue(e.prototype),t,n);return 2&r&&typeof i=="function"?function(s){return i.apply(n,s)}:i}function j(e,t,n,r,i,s){return Br(ue(e.prototype),t,n,r,i)}function te(e){return Cr(e)||Er(e)||Cn(e)||jr()}function qr(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function xn(e){var t=qr(e,"string");return typeof t=="symbol"?t:t+""}function Cn(e,t){if(e){if(typeof e=="string")return Pt(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}var Ie="https://speed.cloudflare.com",Rn={autoStart:!0,downloadApiUrl:"".concat(Ie,"/__down"),uploadApiUrl:"".concat(Ie,"/__up"),logMeasurementApiUrl:null,logAimApiUrl:"https://aim.cloudflare.com/__log",turnServerUri:"turn.speed.cloudflare.com:50000",turnServerCredsApiUrl:"".concat(Ie,"/turn-creds"),turnServerUser:null,turnServerPass:null,rpkiInvalidHost:"invalid.rpki.cloudflare.com",cfTraceUrl:"".concat(Ie,"/cdn-cgi/trace"),includeCredentials:!1,measurements:[{type:"latency",numPackets:1},{type:"download",bytes:1e5,count:1,bypassMinDuration:!0},{type:"latency",numPackets:20},{type:"download",bytes:1e5,count:9},{type:"download",bytes:1e6,count:8},{type:"upload",bytes:1e5,count:8},{type:"packetLoss",numPackets:1e3,batchSize:10,batchWaitTime:10,responsesWaitTime:3e3},{type:"upload",bytes:1e6,count:6},{type:"download",bytes:1e7,count:6},{type:"upload",bytes:1e7,count:4},{type:"download",bytes:25e6,count:4},{type:"upload",bytes:25e6,count:4},{type:"download",bytes:1e8,count:3},{type:"upload",bytes:5e7,count:3},{type:"download",bytes:25e7,count:2}],measureDownloadLoadedLatency:!0,measureUploadLoadedLatency:!0,loadedLatencyThrottle:400,bandwidthFinishRequestDuration:1e3,estimatedServerTime:10,latencyPercentile:.5,bandwidthPercentile:.9,bandwidthMinRequestDuration:10,loadedRequestMinDuration:250,loadedLatencyMaxPoints:20},An={aimMeasurementScoring:{packetLoss:X([.01,.05,.25,.5],[10,5,0,-10,-20]),latency:X([10,20,50,100,500],[20,10,5,0,-10,-20]),loadedLatencyIncrease:X([10,20,50,100,500],[20,10,5,0,-10,-20]),jitter:X([10,20,100,500],[10,5,0,-10,-20]),download:X([1e6,1e7,5e7,1e8],[0,5,10,20,30]),upload:X([1e6,1e7,5e7,1e8],[0,5,10,20,30])},aimExperiencesDefs:{streaming:{input:["latency","packetLoss","download","loadedLatencyIncrease"],pointThresholds:[15,20,40,60]},gaming:{input:["latency","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,30]},rtc:{input:["latency","jitter","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,40]}}},ln=20,En=.005,$r=function(t){var n=t.headers.get("server-timing");if(n){var r=n.match(/dur=([0-9.]+)/);if(r)return+r[1]}},zr=function(t){return t.responseStart-t.requestStart},Nr=function(t){return t.responseEnd-t.responseStart},Hr=function(t){var n=t.ping,r=t.payloadDownloadTime;return n+r},Jr=function(t){var n=t.ttfb;return n},Gr=function(t,n){var r=t.duration,i=t.transferSize,s=8*(i||+n*(1+En)),c=r/1e3;return c?s/c:void 0},Vr=function(t,n){var r=t.duration,i=8*n*(1+En),s=r/1e3;return s?i/s:void 0},Xr=(0,Pn.default)(function(e){return"0".repeat(e)}),He=new WeakMap,Je=new WeakMap,Qe=new WeakMap,xt=new WeakMap,Ct=new WeakMap,Rt=new WeakMap,Ze=new WeakMap,At=new WeakMap,ge=new WeakMap,Et=new WeakMap,Ut=new WeakMap,xe=new WeakMap,Oe=new WeakMap,Re=new WeakMap,Y=new WeakMap,de=new WeakMap,Le=new WeakMap,he=new WeakMap,Ke=new WeakMap,Dt=new WeakMap,Ft=new WeakMap,jt=new WeakMap,G=new WeakSet,fn=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.downloadApiUrl,i=n.uploadApiUrl,s=n.throttleMs,c=s===void 0?0:s,u=n.estimatedServerTime,l=u===void 0?0:u;if(q(this,e),Ae(this,G),p(this,He,{}),p(this,Je,{}),y(this,"finishRequestDuration",1e3),y(this,"getServerTime",$r),p(this,Qe,function(h){return h}),p(this,xt,function(){}),p(this,Ct,function(){}),p(this,Rt,function(){}),p(this,Ze,function(){}),p(this,At,function(){}),p(this,ge,void 0),p(this,Et,void 0),p(this,Ut,void 0),p(this,xe,!1),p(this,Oe,{down:!1,up:!1}),p(this,Re,{down:{},up:{}}),p(this,Y,0),p(this,de,0),p(this,Le,0),p(this,he,-1/0),p(this,Ke,0),p(this,Dt,0),p(this,Ft,void 0),p(this,jt,void 0),!t)throw new Error("Missing measurements argument");if(!r)throw new Error("Missing downloadApiUrl argument");if(!i)throw new Error("Missing uploadApiUrl argument");m(ge,this,t),m(Et,this,r),m(Ut,this,i),m(Ke,this,c),m(Dt,this,Math.max(0,l))}return $(e,[{key:"results",get:function(){return a(Re,this)}},{key:"qsParams",get:function(){return a(He,this)},set:function(n){m(He,this,n)}},{key:"fetchOptions",get:function(){return a(Je,this)},set:function(n){m(Je,this,n)}},{key:"responseHook",set:function(n){m(Qe,this,n)}},{key:"onRunningChange",set:function(n){m(xt,this,n)}},{key:"onNewMeasurementStarted",set:function(n){m(Ct,this,n)}},{key:"onMeasurementResult",set:function(n){m(Rt,this,n)}},{key:"onFinished",set:function(n){m(Ze,this,n)}},{key:"onConnectionError",set:function(n){m(At,this,n)}},{key:"pause",value:function(){clearTimeout(a(jt,this)),g(G,this,Qr).call(this),g(G,this,Ye).call(this,!1)}},{key:"play",value:function(){a(xe,this)||(g(G,this,Ye).call(this,!0),g(G,this,Ge).call(this))}}])}();function Ye(e){var t=this;e!==a(xe,this)&&(m(xe,this,e),setTimeout(function(){return a(xt,t).call(t,a(xe,t))}))}function dn(e,t){var n=this,r=a(ge,this)[e],i=r.bytes,s=r.dir,c=a(Re,this),u=c[s].hasOwnProperty(i)?c[s][i]:{timings:[],numMeasurements:a(ge,this).filter(function(l){var h=l.bytes,d=l.dir;return i===h&&s===d}).map(function(l){return l.count}).reduce(function(l,h){return l+h},0)};t&&u.timings.push(t),u.timings=u.timings.slice(-u.numMeasurements),c[s][i]=u,t?setTimeout(function(){a(Rt,n).call(n,Q({type:s,bytes:i},t),c)}):a(Ct,this).call(this,a(ge,this)[e],c)}function Ge(){var e=this,t=a(ge,this),n=t[a(Y,this)];if(a(de,this)>=n.count){var r=a(Oe,this);if(a(he,this)>this.finishRequestDuration&&!n.bypassMinDuration){var i=n.dir;a(Oe,this)[i]=!0,Object.values(a(Oe,this)).every(function(O){return O})&&a(Ze,this).call(this,a(Re,this))}m(de,this,0),m(he,this,-1/0),performance.clearResourceTimings();do m(Y,this,a(Y,this)+1);while(a(Y,this)<t.length&&r[t[a(Y,this)].dir]);if(a(Y,this)>=t.length){m(Oe,this,{down:!0,up:!0}),g(G,this,Ye).call(this,!1),a(Ze,this).call(this,a(Re,this));return}n=t[a(Y,this)]}var s=a(Y,this);a(de,this)===0&&g(G,this,dn).call(this,s);var c=n,u=c.bytes,l=c.dir,h=l==="down",d=h?a(Et,this):a(Ut,this),v=Object.assign({},a(He,this));h&&(v.bytes="".concat(u));var T="".concat(d.startsWith("http")||d.startsWith("//")?"":window.location.origin).concat(d,"?").concat(Object.entries(v).map(function(O){var A=F(O,2),W=A[0],P=A[1];return"".concat(W,"=").concat(P)}).join("&")),w=Object.assign({},h?{}:{method:"POST",body:Xr(u)},a(Je,this)),R,I=m(Ft,this,fetch(T,w).then(function(O){if(O.ok)return O;throw Error(O.statusText)}).then(function(O){return e.getServerTime&&(R=e.getServerTime(O)),O}).then(function(O){return O.text().then(function(A){return a(Qe,e)&&a(Qe,e).call(e,{url:T,headers:O.headers,body:A}),A})}).then(function(O,A){if(I._cancel){A("cancelled");return}var W=performance.getEntriesByName(T).slice(-1)[0],P={transferSize:W.transferSize,ttfb:zr(W),payloadDownloadTime:Nr(W),serverTime:R||-1,measTime:new Date};if(P.ping=Math.max(.01,P.ttfb-(R||a(Dt,e))),P.duration=(h?Hr:Jr)(P),P.bps=(h?Gr:Vr)(P,u),h&&u){var k=+u;P.transferSize&&(P.transferSize<k||P.transferSize/k>1.05)&&console.warn("Requested ".concat(k,"B but received ").concat(P.transferSize,"B (").concat(Math.round(P.transferSize/k*1e4)/100,"%)."))}g(G,e,dn).call(e,s,P);var M=P.duration;m(he,e,a(he,e)<0?M:Math.min(a(he,e),M)),m(de,e,a(de,e)+1),m(Le,e,0),a(Ke,e)?m(jt,e,setTimeout(function(){return g(G,e,Ge).call(e)},a(Ke,e))):g(G,e,Ge).call(e)}).catch(function(O){var A,W;I._cancel||(console.warn("Error fetching ".concat(T,": ").concat(O)),m(Le,e,(A=a(Le,e),W=A++,A)),W<ln?g(G,e,Ge).call(e):(m(Le,e,0),g(G,e,Ye).call(e,!1),a(At,e).call(e,"Connection failed to ".concat(T,". Gave up after ").concat(ln," retries."))))}))}function Qr(){var e=a(Ft,this);e&&(e._cancel=!0)}var Zr=["measureParallelLatency","parallelLatencyThrottleMs","downloadApiUrl","uploadApiUrl","estimatedServerTime"],B=new WeakMap,It=new WeakMap,gt=new WeakSet,Kr=function(e){function t(n){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.measureParallelLatency,c=s===void 0?!1:s,u=i.parallelLatencyThrottleMs,l=u===void 0?100:u,h=i.downloadApiUrl,d=i.uploadApiUrl,v=i.estimatedServerTime,T=v===void 0?0:v,w=ee(i,Zr);return q(this,t),r=st(this,t,[n,Q({downloadApiUrl:h,uploadApiUrl:d,estimatedServerTime:T},w)]),Ae(r,gt),p(r,B,void 0),p(r,It,void 0),c&&(m(B,r,new fn([{dir:"down",bytes:0,count:1/0,bypassMinDuration:!0}],{downloadApiUrl:h,uploadApiUrl:d,estimatedServerTime:T,throttleMs:l})),a(B,r).qsParams={during:"".concat(n[0].dir,"load")},j(t,"onRunningChange",g(gt,r,hn),r,1),j(t,"onConnectionError",function(){return a(B,r).pause()},r,1)),r}return ot(t,e),$(t,[{key:"latencyResults",get:function(){return a(B,this)&&a(B,this).results.down[0].timings}},{key:"onParallelLatencyResult",set:function(r){a(B,this)&&(a(B,this).onMeasurementResult=function(i){return r(i)})}},{key:"fetchOptions",get:function(){return Fr(t,"fetchOptions",this,1)},set:function(r){j(t,"fetchOptions",r,this,1),a(B,this)&&(a(B,this).fetchOptions=r)}},{key:"onRunningChange",set:function(r){var i=this;j(t,"onRunningChange",function(s){g(gt,i,hn).call(i,s),r(s)},this,1)}},{key:"onConnectionError",set:function(r){var i=this;j(t,"onConnectionError",function(){a(B,i)&&a(B,i).pause(),r.apply(void 0,arguments)},this,1)}}])}(fn);function hn(e){var t=this;a(B,this)&&(e?m(It,this,setTimeout(function(){return a(B,t).play()},20)):(clearTimeout(a(It,this)),a(B,this).pause()))}var Yr=["measurementId","logApiUrl"],Te=new WeakMap,et=new WeakMap,tt=new WeakMap,ve=new WeakMap,_e=new WeakSet,pn=function(e){function t(n){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.measurementId,c=i.logApiUrl,u=ee(i,Yr);return q(this,t),r=st(this,t,[n,u]),Ae(r,_e),p(r,Te,void 0),p(r,et,void 0),p(r,tt,void 0),p(r,ve,void 0),m(Te,r,s),m(ve,r,c),j(t,"qsParams",c?{measId:a(Te,r)}:{},r,1),j(t,"responseHook",function(l){return g(_e,r,mn).call(r,l)},r,1),j(t,"onMeasurementResult",function(l){return g(_e,r,gn).call(r,l)},r,1),r}return ot(t,e),$(t,[{key:"qsParams",set:function(r){j(t,"qsParams",a(ve,this)?Q({measId:a(Te,this)},r):r,this,1)}},{key:"responseHook",set:function(r){var i=this;j(t,"responseHook",function(s){r(s),g(_e,i,mn).call(i,s)},this,1)}},{key:"onMeasurementResult",set:function(r){var i=this;j(t,"onMeasurementResult",function(s){for(var c=arguments.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=arguments[l];r.apply(void 0,[s].concat(u)),g(_e,i,gn).call(i,s)},this,1)}}])}(Kr);function mn(e){a(ve,this)&&(m(tt,this,+e.headers.get("cf-meta-request-time")),m(et,this,e.body.slice(-300).split("___").pop()))}function gn(e){if(a(ve,this)){var t={type:e.type,bytes:e.bytes,ping:Math.round(e.ping),ttfb:Math.round(e.ttfb),payloadDownloadTime:Math.round(e.payloadDownloadTime),duration:Math.round(e.duration),transferSize:Math.round(e.transferSize),serverTime:Math.round(e.serverTime),token:a(et,this),requestTime:a(tt,this),measId:a(Te,this)};m(et,this,null),m(tt,this,null),fetch(a(ve,this),Q({method:"POST",body:JSON.stringify(t)},this.fetchOptions))}}var nt=new WeakMap,qt=new WeakMap,Wt=new WeakMap,pe=new WeakSet,ea=function(){function e(t){if(q(this,e),Ae(this,pe),p(this,nt,!1),p(this,qt,void 0),p(this,Wt,void 0),!t)throw new Error("Missing operation to perform");m(Wt,this,t),this.play()}return $(e,[{key:"pause",value:function(){g(pe,this,ta).call(this),g(pe,this,vn).call(this,!1)}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){a(nt,this)||(g(pe,this,vn).call(this,!0),g(pe,this,Un).call(this))}}])}();function vn(e){e!==a(nt,this)&&m(nt,this,e)}function Un(){var e=this,t=m(qt,this,a(Wt,this).call(this).then(function(){!t._cancel&&g(pe,e,Un).call(e)}))}function ta(){var e=a(qt,this);e&&(e._cancel=!0)}var Se=new WeakMap,na=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.download,i=n.upload;if(q(this,e),y(this,"qsParams",{}),y(this,"fetchOptions",{}),p(this,Se,[]),!r&&!i)throw new Error("Missing at least one of download/upload config");[[r,"download"],[i,"upload"]].filter(function(c){var u=F(c,1),l=u[0];return l}).forEach(function(c){var u=F(c,2),l=u[0],h=u[1],d=l.apiUrl,v=l.chunkSize;if(!d)throw new Error("Missing ".concat(h," apiUrl argument"));if(!v)throw new Error("Missing ".concat(h," chunkSize argument"))});var s=function(u){var l=u.apiUrl,h=u.qsParams,d=h===void 0?{}:h,v=u.fetchOptions,T=v===void 0?{}:v;return new ea(function(){var w=Object.assign({},d,t.qsParams),R="".concat(l.startsWith("http")||l.startsWith("//")?"":window.location.origin).concat(l,"?").concat(Object.entries(w).map(function(O){var A=F(O,2),W=A[0],P=A[1];return"".concat(W,"=").concat(P)}).join("&")),I=Object.assign({},T,t.fetchOptions);return fetch(R,I).then(function(O){if(O.ok)return O;throw Error(O.statusText)}).then(function(O){return O.text()})})};r&&a(Se,this).push(s({apiUrl:r.apiUrl,qsParams:{bytes:"".concat(r.chunkSize)}})),i&&a(Se,this).push(s({apiUrl:i.apiUrl,fetchOptions:{method:"POST",body:"0".repeat(i.chunkSize)}}))}return $(e,[{key:"pause",value:function(){a(Se,this).forEach(function(n){return n.pause()})}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){a(Se,this).forEach(function(n){return n.play()})}}])}(),ra=["iceServers","acceptIceCandidate","dataChannelCfg"],ke=new WeakMap,We=new WeakMap,Be=new WeakMap,Me=new WeakMap,Fe=new WeakMap,aa=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.iceServers,i=r===void 0?[]:r,s=n.acceptIceCandidate,c=s===void 0?function(w){var R=w.protocol||"";if(!R&&w.candidate){var I=w.candidate.split(" ");I.length>=3&&(R=I[2])}return R.toLowerCase()==="udp"}:s,u=n.dataChannelCfg,l=u===void 0?{ordered:!1,maxRetransmits:0}:u,h=ee(n,ra);q(this,e),y(this,"onOpen",function(){}),y(this,"onClose",function(){}),y(this,"onMessageReceived",function(){}),p(this,ke,!1),p(this,We,void 0),p(this,Be,void 0),p(this,Me,void 0),p(this,Fe,void 0);var d=new RTCPeerConnection(Q({iceServers:i},h)),v=new RTCPeerConnection(Q({iceServers:i},h)),T=d.createDataChannel("channel",l);T.onopen=function(){m(ke,t,!0),t.onOpen()},T.onclose=function(){return t.close()},v.ondatachannel=function(w){var R=w.channel;R.onclose=function(){return t.close()},R.onmessage=function(I){return t.onMessageReceived(I.data)},m(Fe,t,R)},d.onicecandidate=function(w){w.candidate&&c(w.candidate)&&v.addIceCandidate(w.candidate)},v.onicecandidate=function(w){w.candidate&&c(w.candidate)&&d.addIceCandidate(w.candidate)},d.createOffer().then(function(w){return d.setLocalDescription(w)}).then(function(){return v.setRemoteDescription(d.localDescription)}).then(function(){return v.createAnswer()}).then(function(w){return v.setLocalDescription(w)}).then(function(){return d.setRemoteDescription(v.localDescription)}),m(We,this,d),m(Be,this,v),m(Me,this,T),m(ke,this,!1)}return $(e,[{key:"send",value:function(n){return a(Me,this).send(n)}},{key:"close",value:function(){return a(We,this)&&a(We,this).close(),a(Be,this)&&a(Be,this).close(),a(Me,this)&&a(Me,this).close(),a(Fe,this)&&a(Fe,this).close(),a(ke,this)&&this.onClose(),m(ke,this,!1),this}}])}(),vt=new WeakMap,qe=new WeakMap,yt=new WeakMap,le=new WeakMap,yn=new WeakMap,bt=new WeakMap,ia=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.turnServerUri,i=n.turnServerCredsApi,s=n.turnServerCredsApiParser,c=s===void 0?function(M){var x=M.username,z=M.credential,K=M.server;return{turnServerUser:x,turnServerPass:z,turnServerUri:K}}:s,u=n.turnServerCredsApiIncludeCredentials,l=u===void 0?!1:u,h=n.turnServerUser,d=n.turnServerPass,v=n.numMsgs,T=v===void 0?100:v,w=n.batchSize,R=w===void 0?10:w,I=n.batchWaitTime,O=I===void 0?10:I,A=n.responsesWaitTime,W=A===void 0?5e3:A,P=n.connectionTimeout,k=P===void 0?5e3:P;if(q(this,e),p(this,vt,function(){}),p(this,qe,function(){}),p(this,yt,function(){}),y(this,"onMsgSent",function(){}),y(this,"onAllMsgsSent",function(){}),y(this,"onMsgReceived",function(){}),p(this,le,{}),p(this,yn,void 0),p(this,bt,void 0),!r&&!i)throw new Error("Missing turnServerCredsApi or turnServerUri argument");if((!h||!d)&&!i)throw new Error("Missing either turnServerCredsApi or turnServerUser+turnServerPass arguments");m(bt,this,T),(!h||!d?fetch(i,{credentials:l?"include":void 0}).then(function(M){return M.json()}).then(function(M){if(M.error)throw M.error;return M}).then(c):Promise.resolve({turnServerUser:h,turnServerPass:d})).catch(function(M){return a(vt,t).call(t,M)}).then(function(M){var x=M.turnServerUser,z=M.turnServerPass,K=M.turnServerUri,o=m(yn,t,new aa({iceServers:[{urls:"turn:".concat(K||r,"?transport=udp"),username:x,credential:z}],iceTransportPolicy:"relay"})),f=!1;setTimeout(function(){f||(o.close(),a(qe,t).call(t,"ICE connection timeout!"))},k);var b=a(le,t);o.onOpen=function(){f=!0;var _=t;(function C(S){if(S<=T){for(var V=S;V<=Math.min(T,S+R-1);)b[V]=!1,o.send(V),_.onMsgSent(V),V++;setTimeout(function(){return C(V)},O)}else{_.onAllMsgsSent(Object.keys(b).length);var re=function(){o.close(),a(yt,_).call(_,_.results)},be=setTimeout(re,W),U=Object.values(a(le,_)).filter(function(N){return!N}).length;o.onMessageReceived=function(N){clearTimeout(be),b[N]=!0,_.onMsgReceived(N),U--,U<=0&&Object.values(a(le,_)).every(function(In){return In})?re():be=setTimeout(re,W)}}})(1)},o.onMessageReceived=function(_){b[_]=!0,t.onMsgReceived(_)}}).catch(function(M){return a(qe,t).call(t,M.toString())})}return $(e,[{key:"onCredentialsFailure",set:function(n){m(vt,this,n)}},{key:"onConnectionError",set:function(n){m(qe,this,n)}},{key:"onFinished",set:function(n){m(yt,this,n)}},{key:"results",get:function(){var n=a(bt,this),r=Object.keys(a(le,this)).length,i=Object.entries(a(le,this)).filter(function(c){var u=F(c,2),l=u[1];return!l}).map(function(c){var u=F(c,1),l=u[0];return+l}),s=i.length/r;return{totalMessages:n,numMessagesSent:r,packetLoss:s,lostMessages:i}}}])}(),sa=["downloadChunkSize","uploadChunkSize","downloadApiUrl","uploadApiUrl"],H=new WeakMap,oa=function(e){function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=r.downloadChunkSize,s=r.uploadChunkSize,c=r.downloadApiUrl,u=r.uploadApiUrl,l=ee(r,sa);return q(this,t),n=st(this,t,[l]),p(n,H,void 0),(i||s)&&(m(H,n,new na({download:i?{apiUrl:c,chunkSize:i}:null,upload:s?{apiUrl:u,chunkSize:s}:null})),j(t,"onCredentialsFailure",j(t,"onConnectionError",j(t,"onFinished",function(){return a(H,n).stop()},n,1,1),n,1,1),n,1)),n}return ot(t,e),$(t,[{key:"qsParams",set:function(r){a(H,this)&&(a(H,this).qsParams=r)}},{key:"fetchOptions",set:function(r){a(H,this)&&(a(H,this).fetchOptions=r)}},{key:"onCredentialsFailure",set:function(r){var i=this;j(t,"onCredentialsFailure",function(){r.apply(void 0,arguments),a(H,i)&&a(H,i).stop()},this,1)}},{key:"onConnectionError",set:function(r){var i=this;j(t,"onConnectionError",function(){r.apply(void 0,arguments),a(H,i)&&a(H,i).stop()},this,1)}},{key:"onFinished",set:function(r){var i=this;j(t,"onFinished",function(){r.apply(void 0,arguments),a(H,i)&&a(H,i).stop()},this,1)}}])}(ia),ua=["reachable"],wt=$(function e(t){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.timeout,s=i===void 0?-1:i,c=r.fetchOptions,u=c===void 0?{}:c;q(this,e),y(this,"onFinished",function(){});var l=!1,h=function(v){var T=v.reachable,w=ee(v,ua);l||(l=!0,n.onFinished(Q({targetUrl:t,reachable:T},w)))};fetch(t,u).then(function(d){h({reachable:!0,response:d})}).catch(function(d){h({reachable:!1,error:d})}),s>0&&setTimeout(function(){return h({reachable:!1,error:"Request timeout"})},s)}),ca=function(t){return t.reduce(function(n,r){return n+r},0)},bn=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;if(!t.length)return 0;var r=t.slice().sort(function(u,l){return u-l}),i=(t.length-1)*n,s=i%1;if(s===0)return r[Math.round(i)];var c=[Math.floor,Math.ceil].map(function(u){return r[u(i)]});return c[0]+(c[1]-c[0])*s},oe=new WeakMap,$e=new WeakMap,la=function(){function e(t){var n=this;q(this,e),y(this,"getLatencyPoints",function(r){return r.timings.map(function(i){return i.ping})}),y(this,"getLatency",function(r){return bn(n.getLatencyPoints(r),a(oe,n).latencyPercentile)}),y(this,"getBandwidthPoints",function(r){return Object.entries(r).map(function(i){var s=F(i,2),c=s[0],u=s[1].timings;return u.map(function(l){var h=l.bps,d=l.duration,v=l.ping,T=l.measTime,w=l.serverTime,R=l.transferSize;return{bytes:+c,bps:h,duration:d,ping:v,measTime:T,serverTime:w,transferSize:R}})}).flat()}),y(this,"getBandwidth",function(r){return bn(n.getBandwidthPoints(r).filter(function(i){return i.duration>=a(oe,n).bandwidthMinRequestDuration}).map(function(i){return i.bps}).filter(function(i){return i}),a(oe,n).bandwidthPercentile)}),y(this,"getLoadedLatency",function(r){return n.getLatency({timings:a($e,n).call(n,r)})}),y(this,"getLoadedJitter",function(r){return n.getJitter({timings:a($e,n).call(n,r)})}),y(this,"getLoadedLatencyPoints",function(r){return n.getLatencyPoints({timings:a($e,n).call(n,r)})}),y(this,"getPacketLoss",function(r){return r.packetLoss}),y(this,"getPacketLossDetails",function(r){return r}),y(this,"getReachability",function(r){return!!r.reachable}),y(this,"getReachabilityDetails",function(r){return{host:r.host,reachable:r.reachable}}),p(this,oe,void 0),p(this,$e,function(r){return Object.values(r).filter(function(i){return i.timings.length&&Math.min.apply(Math,te(i.timings.map(function(s){return s.duration})))>=a(oe,n).loadedRequestMinDuration}).map(function(i){return i.sideLatency||[]}).flat().slice(-a(oe,n).loadedLatencyMaxPoints)}),m(oe,this,t)}return $(e,[{key:"getJitter",value:function(n){var r=this.getLatencyPoints(n);return r.length<2?null:r.reduce(function(i,s){var c=i.sumDeltas,u=c===void 0?0:c,l=i.prevLatency;return{sumDeltas:u+(l!==void 0?Math.abs(l-s):0),prevLatency:s}},{}).sumDeltas/(r.length-1)}}])}(),fa=["bad","poor","average","good","great"],wn={loadedLatencyIncrease:function(t){return t.latency&&(t.downLoadedLatency||t.upLoadedLatency)?Math.max(t.downLoadedLatency,t.upLoadedLatency)-t.latency:void 0}},_n={packetLoss:0},ze=new WeakMap,da=function(){function e(t){q(this,e),p(this,ze,void 0),m(ze,this,t)}return $(e,[{key:"getScores",value:function(n){var r=Object.assign.apply(Object,te(Object.entries(a(ze,this).aimMeasurementScoring).map(function(i){var s=F(i,2),c=s[0],u=s[1],l=wn.hasOwnProperty(c)?wn[c](n):n[c];return l===void 0?_n.hasOwnProperty(c)?y({},c,_n[c]):{}:y({},c,l===void 0?0:+u(l))})));return Object.assign.apply(Object,[{}].concat(te(Object.entries(a(ze,this).aimExperiencesDefs).filter(function(i){var s=F(i,2),c=s[1].input;return c.every(function(u){return r.hasOwnProperty(u)})}).map(function(i){var s=F(i,2),c=s[0],u=s[1],l=u.input,h=u.pointThresholds,d=Math.max(0,ca(l.map(function(w){return r[w]}))),v=X(h,[0,1,2,3,4])(d),T=fa[v];return y({},c,{points:d,classificationIdx:v,classificationName:T})}))))}}])}(),Pe=new WeakMap,_t=new WeakMap,St=new WeakMap,D=new WeakMap,Sn=new WeakMap,ha=new WeakMap,kn=new WeakMap,pa=new WeakMap,ma=function(){function e(t){var n=this;q(this,e),y(this,"raw",void 0),y(this,"getUnloadedLatency",function(){return a(D,n).call(n,"getLatency","latency")}),y(this,"getUnloadedJitter",function(){return a(D,n).call(n,"getJitter","latency")}),y(this,"getUnloadedLatencyPoints",function(){return a(D,n).call(n,"getLatencyPoints","latency",[])}),y(this,"getDownLoadedLatency",function(){return a(D,n).call(n,"getLoadedLatency","download")}),y(this,"getDownLoadedJitter",function(){return a(D,n).call(n,"getLoadedJitter","download")}),y(this,"getDownLoadedLatencyPoints",function(){return a(D,n).call(n,"getLoadedLatencyPoints","download",[])}),y(this,"getUpLoadedLatency",function(){return a(D,n).call(n,"getLoadedLatency","upload")}),y(this,"getUpLoadedJitter",function(){return a(D,n).call(n,"getLoadedJitter","upload")}),y(this,"getUpLoadedLatencyPoints",function(){return a(D,n).call(n,"getLoadedLatencyPoints","upload",[])}),y(this,"getDownloadBandwidth",function(){return a(D,n).call(n,"getBandwidth","download")}),y(this,"getDownloadBandwidthPoints",function(){return a(D,n).call(n,"getBandwidthPoints","download",[])}),y(this,"getUploadBandwidth",function(){return a(D,n).call(n,"getBandwidth","upload")}),y(this,"getUploadBandwidthPoints",function(){return a(D,n).call(n,"getBandwidthPoints","upload",[])}),y(this,"getPacketLoss",function(){return a(D,n).call(n,"getPacketLoss","packetLoss")}),y(this,"getPacketLossDetails",function(){return a(D,n).call(n,"getPacketLossDetails","packetLoss",void 0,!0)}),y(this,"getScores",function(){return a(St,n).getScores(n.getSummary())}),p(this,Pe,void 0),p(this,_t,void 0),p(this,St,void 0),p(this,D,function(r,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return!n.raw.hasOwnProperty(i)||!n.raw[i].started?s:c&&n.raw[i].error?{error:n.raw[i].error}:a(_t,n)[r](n.raw[i].results)}),p(this,Sn,function(){return a(D,n).call(n,"getReachability","v4Reachability")}),p(this,ha,function(){return a(D,n).call(n,"getReachabilityDetails","v4Reachability")}),p(this,kn,function(){return a(D,n).call(n,"getReachability","v6Reachability")}),p(this,pa,function(){return a(D,n).call(n,"getReachabilityDetails","v6Reachability")}),m(Pe,this,t),this.clear(),m(_t,this,new la(a(Pe,this))),m(St,this,new da(a(Pe,this)))}return $(e,[{key:"isFinished",get:function(){return Object.values(this.raw).every(function(n){return n.finished})}},{key:"clear",value:function(){this.raw=Object.assign.apply(Object,[{}].concat(te(te(new Set(a(Pe,this).measurements.map(function(n){return n.type}))).map(function(n){return y({},n,{started:!1,finished:!1,results:{}})}))))}},{key:"getSummary",value:function(){var n={download:this.getDownloadBandwidth,upload:this.getUploadBandwidth,latency:this.getUnloadedLatency,jitter:this.getUnloadedJitter,downLoadedLatency:this.getDownLoadedLatency,downLoadedJitter:this.getDownLoadedJitter,upLoadedLatency:this.getUpLoadedLatency,upLoadedJitter:this.getUpLoadedJitter,packetLoss:this.getPacketLoss,v4Reachability:a(Sn,this),v6Reachability:a(kn,this)};return Object.assign.apply(Object,te(Object.entries(n).map(function(r){var i=F(r,2),s=i[0],c=i[1],u=c();return u===void 0?{}:y({},s,u)})))}}])}(),$t=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t&&Math.round(t*Math.pow(10,n))/Math.pow(10,n)},kt=function(t){return t.map(function(n){return $t(n,2)})},Mn=function(t){return t.map(function(n){return{bytes:+n.bytes,bps:$t(n.bps)}})},ga=function(t){return t.error?void 0:{numMessages:t.numMessagesSent,lossRatio:$t(t.packetLoss,4)}},va={latencyMs:["getUnloadedLatencyPoints",kt],download:["getDownloadBandwidthPoints",Mn],upload:["getUploadBandwidthPoints",Mn],downLoadedLatencyMs:["getDownLoadedLatencyPoints",kt],upLoadedLatencyMs:["getUpLoadedLatencyPoints",kt],packetLoss:["getPacketLossDetails",ga]},ya=function(t){return{points:t.points,classification:t.classificationName}},ba=function(t,n){var r=n.apiUrl,i={};Object.entries(va).forEach(function(c){var u=F(c,2),l=u[0],h=F(u[1],2),d=h[0],v=h[1],T=v===void 0?function(R){return R}:v,w=t[d]();w&&(i[l]=T(w))});var s=t.getScores();s&&(i.scores=Object.assign.apply(Object,[{}].concat(te(Object.entries(s).map(function(c){var u=F(c,2),l=u[0],h=u[1];return y({},l,ya(h))}))))),fetch(r,{method:"POST",body:JSON.stringify(i)})},wa=["type"],_a=["numPackets"],Sa=["bytes"],ka=1e6,Ma=1e6,Pa=.5,zt=["latency","latencyUnderLoad","download","upload"],Dn=function(){return"".concat(Math.round(Math.random()*1e16))},Bt=new WeakMap,me=new WeakMap,E=new WeakMap,Ce=new WeakMap,rt=new WeakMap,Z=new WeakMap,ye=new WeakMap,Ve=new WeakMap,Xe=new WeakMap,ne=new WeakMap,at=new WeakMap,L=new WeakSet,Oa=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,e),Ae(this,L),y(this,"onRunningChange",function(){}),y(this,"onResultsChange",function(){}),p(this,Bt,function(){}),p(this,me,function(){}),p(this,E,void 0),p(this,Ce,void 0),p(this,rt,Dn()),p(this,Z,-1),p(this,ye,void 0),p(this,Ve,ka),p(this,Xe,Ma),p(this,ne,!1),p(this,at,!1),m(E,this,Object.assign({},Rn,t,An)),m(Ce,this,new ma(a(E,this))),a(E,this).autoStart&&this.play()}return $(e,[{key:"results",get:function(){return a(Ce,this)}},{key:"isRunning",get:function(){return a(ne,this)}},{key:"isFinished",get:function(){return a(at,this)}},{key:"onFinish",set:function(n){m(Bt,this,n)}},{key:"onError",set:function(n){m(me,this,n)}},{key:"pause",value:function(){zt.includes(g(L,this,ut).call(this))&&a(ye,this).pause(),g(L,this,it).call(this,!1)}},{key:"play",value:function(){a(ne,this)||(g(L,this,it).call(this,!0),g(L,this,J).call(this))}},{key:"restart",value:function(){g(L,this,La).call(this),this.play()}}])}();function it(e){e!==a(ne,this)&&(m(ne,this,e),this.onRunningChange(a(ne,this)))}function jn(e){var t=this;e!==a(at,this)&&(m(at,this,e),e&&setTimeout(function(){return a(Bt,t).call(t,t.results)}))}function ut(){return a(Z,this)<0||a(Z,this)>=a(E,this).measurements.length?null:a(E,this).measurements[a(Z,this)].type}function fe(){return a(Ce,this).raw[g(L,this,ut).call(this)]||void 0}function La(){g(L,this,Ta).call(this),m(rt,this,Dn()),m(Z,this,-1),m(ye,this,void 0),g(L,this,it).call(this,!1),g(L,this,jn).call(this,!1),a(Ce,this).clear()}function Ta(){var e=a(ye,this);e&&(e.onFinished=e.onConnectionError=e.onFail=e.onMsgReceived=e.onCredentialsFailure=e.onMeasurementResult=function(){},zt.includes(g(L,this,ut).call(this))&&e.pause())}function J(){var e=this,t;if(zt.includes(g(L,this,ut).call(this))&&g(L,this,fe).call(this)&&g(L,this,fe).call(this).started&&!g(L,this,fe).call(this).finished&&!g(L,this,fe).call(this).finishedCurrentRound&&!g(L,this,fe).call(this).error){a(ye,this).play();return}if(m(Z,this,(t=a(Z,this),t++,t)),a(Z,this)>=a(E,this).measurements.length){g(L,this,it).call(this,!1),g(L,this,jn).call(this,!0);return}var n=a(E,this).measurements[a(Z,this)],r=n.type,i=ee(n,wa),s=g(L,this,fe).call(this),c=a(E,this),u=c.downloadApiUrl,l=c.uploadApiUrl,h=c.estimatedServerTime,d;switch(r){case"v4Reachability":case"v6Reachability":d=new wt("https://".concat(i.host),{fetchOptions:{method:"GET",mode:"no-cors"}}),d.onFinished=function(k){s.finished=!0,s.results=Q({host:i.host},k),e.onResultsChange({type:r}),g(L,e,J).call(e)};break;case"rpki":d=new wt("https://".concat(a(E,this).rpkiInvalidHost),{timeout:5e3}),d.onFinished=function(k){(k.response?k.response.json():Promise.resolve()).then(function(M){s.finished=!0,s.results=Q({host:a(E,e).rpkiInvalidHost,filteringInvalids:!k.reachable},M?{asn:M.asn,name:M.name}:{}),e.onResultsChange({type:r}),g(L,e,J).call(e)})};break;case"nxdomain":d=new wt("https://".concat(i.nxhost),{fetchOptions:{mode:"no-cors"}}),d.onFinished=function(k){s.finished=!0,s.results={host:i.nxhost,reachable:k.reachable},e.onResultsChange({type:r}),g(L,e,J).call(e)};break;case"packetLoss":case"packetLossUnderLoad":{s.finished=!1;var v=i.numPackets,T=ee(i,_a),w=a(E,this),R=w.turnServerUri,I=w.turnServerCredsApiUrl,O=w.turnServerUser,A=w.turnServerPass,W=w.includeCredentials;d=new oa(Q({turnServerUri:R,turnServerCredsApi:I,turnServerCredsApiIncludeCredentials:W,turnServerUser:O,turnServerPass:A,numMsgs:v,downloadChunkSize:i.loadDown?a(Ve,this):void 0,uploadChunkSize:i.loadUp?a(Xe,this):void 0,downloadApiUrl:u,uploadApiUrl:l},T))}d.onMsgReceived=function(){s.results=Object.assign({},d.results),e.onResultsChange({type:r})},d.onFinished=function(){s.finished=!0,e.onResultsChange({type:r}),g(L,e,J).call(e)},d.onConnectionError=function(k){s.error=k,e.onResultsChange({type:r}),a(me,e).call(e,"Connection error while measuring packet loss: ".concat(k)),g(L,e,J).call(e)},d.onCredentialsFailure=function(){s.error="unable to get turn server credentials",e.onResultsChange({type:r}),a(me,e).call(e,"Error while measuring packet loss: unable to get turn server credentials."),g(L,e,J).call(e)};break;case"latency":case"latencyUnderLoad":s.finished=!1,d=new pn([{dir:"down",bytes:0,count:i.numPackets,bypassMinDuration:!0}],{downloadApiUrl:u,uploadApiUrl:l,estimatedServerTime:h,logApiUrl:a(E,this).logMeasurementApiUrl,measurementId:a(rt,this),downloadChunkSize:i.loadDown?a(Ve,this):void 0,uploadChunkSize:i.loadUp?a(Xe,this):void 0}),d.fetchOptions={credentials:a(E,this).includeCredentials?"include":void 0},d.onMeasurementResult=d.onNewMeasurementStarted=function(k,M){s.results=Object.assign({},M.down[0]),e.onResultsChange({type:r})},d.onFinished=function(){s.finished=!0,e.onResultsChange({type:r}),a(ne,e)&&g(L,e,J).call(e)},d.onConnectionError=function(k){s.error=k,e.onResultsChange({type:r}),a(me,e).call(e,"Connection error while measuring latency: ".concat(k)),g(L,e,J).call(e)},d.play();break;case"download":case"upload":if(s.finished||s.error)g(L,this,J).call(this);else{delete s.finishedCurrentRound;var P=a(E,this)["measure".concat(r==="download"?"Down":"Up","loadLoadedLatency")];d=new pn([Q({dir:r==="download"?"down":"up"},i)],{downloadApiUrl:u,uploadApiUrl:l,estimatedServerTime:h,logApiUrl:a(E,this).logMeasurementApiUrl,measurementId:a(rt,this),measureParallelLatency:P,parallelLatencyThrottleMs:a(E,this).loadedLatencyThrottle}),d.fetchOptions={credentials:a(E,this).includeCredentials?"include":void 0},d.finishRequestDuration=a(E,this).bandwidthFinishRequestDuration,d.onNewMeasurementStarted=function(k){var M=k.count,x=k.bytes,z=s.results=Object.assign({},s.results);!z.hasOwnProperty(x)&&(z[x]={timings:[],numMeasurements:0,sideLatency:P?[]:void 0}),z[x].numMeasurements-z[x].timings.length!==M&&(z[x].numMeasurements+=M,e.onResultsChange({type:r}))},d.onMeasurementResult=function(k){var M=k.bytes,x=ee(k,Sa);s.results[M].timings.push(x),s.results=Object.assign({},s.results),e.onResultsChange({type:r})},d.onParallelLatencyResult=function(k){s.results[i.bytes].sideLatency.push(k),s.results=Object.assign({},s.results),e.onResultsChange({type:r})},d.onFinished=function(k){var M=!a(E,e).measurements.slice(a(Z,e)+1).map(function(f){return f.type}).includes(r),x=Math.min.apply(Math,te(Object.values(r==="download"?k.down:k.up).slice(-1)[0].timings.map(function(f){return f.duration}))),z=M||!i.bypassMinDuration&&x>a(E,e).bandwidthFinishRequestDuration;if(!z)s.finishedCurrentRound=!0;else{s.finished=!0,e.onResultsChange({type:r});var K=Object.keys(s.results).map(function(f){return+f}).sort(function(f,b){return b-f})[0],o=K*Pa;r==="download"&&m(Ve,e,o),r==="upload"&&m(Xe,e,o)}a(ne,e)&&g(L,e,J).call(e)},d.onConnectionError=function(k){s.error=k,e.onResultsChange({type:r}),a(me,e).call(e,"Connection error while measuring ".concat(r,": ").concat(k)),g(L,e,J).call(e)},d.play()}break}m(ye,this,d),s.started=!0,this.onResultsChange({type:r})}var Ne=new WeakMap,Mt=new WeakMap,Ka=function(e){function t(n){var r;q(this,t);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return r=st(this,t,[n].concat(s)),p(r,Ne,void 0),p(r,Mt,function(u){a(Ne,r)&&ba(u,{apiUrl:a(Ne,r)})}),j(t,"onFinish",a(Mt,r),r,1),m(Ne,r,Object.assign({},Rn,n,An).logAimApiUrl),r}return ot(t,e),$(t,[{key:"onFinish",set:function(r){var i=this;j(t,"onFinish",function(s){r(s),a(Mt,i).call(i,s)},this,1)}}])}(Oa);export{Ka as default};
//# sourceMappingURL=speedtest.bundle.mjs.map